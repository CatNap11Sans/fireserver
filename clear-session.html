<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpar Sess√£o - Fire Server</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .clear-session-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 2rem;
        }
        .clear-session-box {
            background: white;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            max-width: 500px;
        }
        .icon-warning {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        .status {
            margin: 2rem 0;
            padding: 1rem;
            border-radius: 6px;
            font-weight: 500;
        }
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .status.processing {
            background: #fff3e0;
            color: #e65100;
        }
    </style>
</head>
<body>
    <div class="clear-session-container">
        <div class="clear-session-box">
            <div class="icon-warning">üîß</div>
            <h1>Limpar Sess√£o</h1>
            <p>Esta p√°gina ir√° limpar todos os dados de sess√£o e fazer logout completo.</p>
            
            <div id="status" class="status processing">
                Processando...
            </div>

            <p style="color: #666; font-size: 0.875rem; margin-top: 2rem;">
                Use esta p√°gina apenas se voc√™ estiver tendo problemas com login fantasma ou dados corrompidos.
            </p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script src="js/firebase-config.js"></script>
    <script>
        async function clearSession() {
            const statusEl = document.getElementById('status');
            
            try {
                // 1. Sign out from Firebase
                statusEl.innerHTML = 'üîÑ Fazendo logout do Firebase...';
                await auth.signOut();

                // 2. Clear session storage
                statusEl.innerHTML = 'üîÑ Limpando session storage...';
                if (window.sessionStorage) {
                    sessionStorage.clear();
                }

                // 3. Clear localStorage (Firebase keys only)
                statusEl.innerHTML = 'üîÑ Limpando local storage...';
                if (window.localStorage) {
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('firebase:') || key.startsWith('firebaseui::')) {
                            keysToRemove.push(key);
                        }
                    }
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                }

                // 4. Clear cookies (if any)
                statusEl.innerHTML = 'üîÑ Limpando cookies...';
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "")
                        .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });

                // 5. Clear IndexedDB (Firebase uses it)
                statusEl.innerHTML = 'üîÑ Limpando banco de dados local...';
                if (window.indexedDB) {
                    const databases = await window.indexedDB.databases();
                    for (const db of databases) {
                        if (db.name.includes('firebase')) {
                            window.indexedDB.deleteDatabase(db.name);
                        }
                    }
                }

                // Success!
                statusEl.className = 'status success';
                statusEl.innerHTML = '‚úÖ Sess√£o limpa com sucesso!<br>Redirecionando em 3 segundos...';

                setTimeout(() => {
                    window.location.href = './index.html';
                }, 3000);

            } catch (error) {
                console.error('Error clearing session:', error);
                statusEl.className = 'status';
                statusEl.style.background = '#ffebee';
                statusEl.style.color = '#c62828';
                statusEl.innerHTML = '‚ùå Erro: ' + error.message + '<br><br>' +
                    '<button class="btn btn-primary" onclick="location.reload()">Tentar Novamente</button>';
            }
        }

        // Auto-run when page loads
        window.addEventListener('DOMContentLoaded', clearSession);
    </script>
</body>
</html>
